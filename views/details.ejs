<%- include("partials/header.ejs") %> <% if(post) { %>
<div class="d-flex align-items-center">
  <img
    src="<%= post.user.pp %>"
    class="rounded-circle"
    style="max-height: 100px; border: 2px solid var(--accent1)"
  />
  <div class="d-flex flex-column ms-2 me-auto">
    <!-- ms-2 untuk margin kiri 2, me-auto untuk margin kanan otomatis -->
    <h3 class="h2" style="margin-bottom: 5px"><%= post.user.name %></h3>
    <p style="margin-bottom: 5px" class="text-secondary">
      @<%= post.user.username %>
    </p>
    <p style="margin-bottom: 0">Etto...Hi:3</p>
  </div>

  <button
    class="btn btn-success rounded-pill ms-0 p-3 pt-1 pb-1"
    style="height: fit-content; font-size: larger"
    onclick="followPost('<%= post.user.username %>')"
    id="follow"
  >
    Follow
  </button>
</div>
<div class="d-flex mt-2" style="padding-left: 5px">
  <p style="color: var(--accent1)">
    <i class="fa-solid fa-user-group"></i> <%= post.user.following.length %>
    following
  </p>
  <p class="ms-2" style="color: var(--accent2)">
    <i class="fa-solid fa-user-group"></i> <%= post.user.followers.length %>
    followers
  </p>
</div>
<div class="card bg-dark text-white p-3 mt-2 rounded-lg">
  <div class="d-flex align-items-center">
    <img src="<%= post.user.pp %>" class="pfp rounded-circle" />
    <div class="d-flex flex-column ms-2 me-auto pt-2">
      <!-- ms-2 untuk margin kiri 2, me-auto untuk margin kanan otomatis -->
      <h4>
        <%= post.user.name %> <%= post.reQuote ? `is Requote to
        ${post.reQuote.user.name}` : "" %>
      </h4>
      <h4 class="text-secondary"><%= post.time %></h4>
    </div>
  </div>
  <h3 class="h2"><%= post.title %></h3>
  <% if(post.img) %> <img src="<%= post.img %>" />
  <% if(post.reQuote) { %>
  <div class="card bg-dark text-white p-2 mb-2 mt-2 border-1 border-secondary">
    <a href="/?id=<%= post.reQuote.id %>">
      <article class="d-flex pt-2">
        <img class="pfp rounded-circle" src="<%= post.reQuote.user.pp %>" />
        <div class="ms-2">
          <h4><%= post.reQuote.user.name %></h4>
          <h4 class="text-secondary"><%= post.reQuote.time %></h4>
        </div>
      </article>
      <h3><%= post.reQuote.title.replace(/<[^>]+>/g, "") %></h3>
      <% if(post.reQuote.img) { %> <img src="<%= post.reQuote.img %>" /> <% } %>
    </a>
  </div>
  <% } %>
  <div class="d-flex mb-2">
    <button
      class="btn btn-success rounded-pill"
      onclick="sendLikeRequest('<%= JSON.stringify(post) %>', this)"
    >
      <i class="fa-solid fa-heart"></i> <%= post.like.total %>
    </button>
    <button
      class="btn btn-secondary rounded-pill ms-1"
      onclick="sendPostRequest(undefined, undefined, undefined, '<%= post.id %>', '<%= JSON.stringify(post) %>')"
    >
      <i class="fa-solid fa-recycle"></i> Repost
    </button>
  </div>
  <hr style="opacity: 100%; border-top: 1px solid var(--accent1) !important" />
  <form
    onsubmit="sendPostRequest(this, '<%= JSON.stringify(post) %>', undefined, undefined, undefined)"
  >
    <div class="d-flex flex-column mb-2">
      <label for="title" class="h3">
        Reply <i class="fa-solid fa-reply"></i
      ></label>
      <input type="text" class="form-control" id="title" name="title" />
    </div>
    <button
      class="btn btn-success rounded-pill p-4 pt-1 pb-1"
      style="font-size: larger"
      type="submit"
    >
      Post
    </button>
    <input type="file" class="form-control d-none" id="img" name="img" />
    <label
      for="img"
      class="btn btn-secondary rounded-pill"
      style="font-size: larger"
      ><i class="fa-solid fa-image"></i
    ></label>
  </form>
  <form
    onsubmit="sendPostRequest(this, undefined, '<%= JSON.stringify(post) %>', undefined, undefined)"
  >
    <div class="d-flex flex-column mb-2 mt-2">
      <label for="title" class="h3">
        Requote <i class="fa-solid fa-recycle"></i
      ></label>
      <input type="text" class="form-control" id="title" name="title" />
    </div>
    <button
      class="btn btn-success rounded-pill p-4 pt-1 pb-1"
      style="font-size: larger"
      type="submit"
    >
      Post
    </button>
    <input type="file" class="form-control d-none" id="img" name="img" />
    <label
      for="img"
      class="btn btn-secondary rounded-pill"
      style="font-size: larger"
      ><i class="fa-solid fa-image"></i
    ></label>
  </form>
  <% replies.forEach((reply) => { %>
  <a href="/?id=<%=reply.id %>">
    <h3><%= reply.user.name %></h3>
    <h2><%= reply.title %></h2>
    <h3><%= reply.time %></h3>
    <button onclick="sendLikeRequest(reply, this)">
      <i class="fa-solid fa-heart"></i> <%= reply.like.total %>
    </button>
    <% if(reply.img) %> <img class="pfp" src="<%= reply.img %>" />
  </a>
  <% }); %> <% if(post.img) %>
</div>
<% } %> <%- include("partials/footer.ejs") %>
<script>
  fetch(`/user/follow/<%= post.user.username %>?myname=${username}`)
    .then((res) => res.json())
    .then((check) => {
      if (check.isFollowing) {
        document.getElementById("follow").innerText = "Unfollow";
      }
    });

  if ("<%= post.user.username %>" === username) {
    document.getElementById("follow").remove();
  }
</script>
